---
title: "Parameter Sensitivity Analysis"
subtitle: "Understanding Which Parameters Drive Model Outcomes"
---

::: {.callout-note}
**NOTE: AI Generated. Still to be verified by Willy.**
:::

## Overview

This vignette explores **sensitivity analysis**: how much do model outputs change when we vary each input parameter?

Identifying sensitive parameters is crucial for:
- Prioritizing data collection
- Understanding system behavior
- Identifying critical control points
- Allocating research/intervention resources

## Methodology

### One-at-a-Time (OAT) Sensitivity

For each parameter:

1. Set to baseline value
2. Vary across a range (typically ±50%)
3. Run simulations
4. Measure output change
5. Plot parameter vs. outcome

### Batch Configuration

Create `sensitivity_params.xml`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<batch runs="5">
    <!-- Baseline group -->
    <parameter name="longTermAcuteCareBeta" value="0.0615"/>
    <parameter name="importationRate" value="0.206"/>
    <parameter name="avgDecolonizationTime" value="387"/>
    <parameter name="isolationEffectiveness" value="0.5"/>
    <parameter name="daysBetweenTests" value="14"/>
    <parameter name="doActiveSurveillanceAfterBurnIn" value="true"/>

    <!-- Beta sweep: 0.015 to 0.15 (5 values)  -->
    <sweep name="beta_sweep">
        <parameter name="longTermAcuteCareBeta" type="range" from="0.015" to="0.15" step="0.027"/>
    </sweep>

    <!-- Importation sweep -->
    <sweep name="import_sweep">
        <parameter name="importationRate" type="range" from="0.05" to="0.35" step="0.06"/>
    </sweep>

    <!-- etc. for other parameters -->
    <parameter name="isBatchRun" value="true"/>
</batch>
```

## Key Parameters & Expected Sensitivity

### High Sensitivity Parameters

#### 1. Beta (Transmission Coefficient)

**Range**: 0.015 to 0.15 (10-fold variation)

**Expected relationship**: Linear or super-linear with prevalence

**Code**:
```r
# Load multiple beta values
beta_sweep <- bind_rows(
  load_scenario("beta_0015.csv", beta = 0.015),
  load_scenario("beta_0042.csv", beta = 0.042),
  load_scenario("beta_0069.csv", beta = 0.069),
  load_scenario("beta_0096.csv", beta = 0.096),
  load_scenario("beta_0123.csv", beta = 0.123),
  load_scenario("beta_0150.csv", beta = 0.150)
) %>%
  filter(Tick > 3650)  # Measurement period

# Plot
beta_sweep %>%
  group_by(beta) %>%
  summarize(Mean_Prev = mean(PrevalencePercent)) %>%
  ggplot(aes(x = beta, y = Mean_Prev)) +
  geom_point(size = 3) +
  geom_line() +
  labs(
    title = "Sensitivity: Transmission Coefficient (Beta)",
    x = "Beta Value",
    y = "Mean Prevalence (%)"
  ) +
  theme_minimal()
```

**Expected output**:
```
Beta     Mean Prevalence
0.015         2.1%
0.042         4.8%
0.069         9.2%
0.096        14.5%
0.123        19.2%
0.150        23.1%
```

**Interpretation**:
- Strong positive relationship
- Non-linear (diminishing returns at high values)
- 10-fold increase in β → ~10-fold increase in prevalence

#### 2. Importation Rate

**Range**: 0.05 to 0.35

**Expected relationship**: Linear increase in endemic prevalence

**Code**:
```r
# Similar to beta analysis
import_sweep %>%
  group_by(importation_rate) %>%
  summarize(Mean_Prev = mean(PrevalencePercent)) %>%
  ggplot(aes(x = importation_rate, y = Mean_Prev)) +
  geom_point(size = 3) +
  geom_line() +
  labs(
    title = "Sensitivity: Importation Rate",
    x = "Importation Rate (Probability)",
    y = "Mean Prevalence (%)"
  )
```

**Expected output**:
```
Importation Rate   Mean Prevalence
0.05                   5.2%
0.137                 10.1%
0.224                 15.3%
0.311                 20.2%
0.35                  23.5%
```

**Interpretation**:
- Strong linear relationship
- Higher importation = higher endemic prevalence
- Approximately proportional increase

### Medium Sensitivity Parameters

#### 3. Decolonization Time

**Range**: 200 to 600 days

**Expected**: Moderate impact on prevalence

```r
deco_sweep %>%
  group_by(avg_deco_time) %>%
  summarize(Mean_Prev = mean(PrevalencePercent)) %>%
  ggplot(aes(x = avg_deco_time, y = Mean_Prev)) +
  geom_point(size = 3) +
  geom_line() +
  labs(title = "Sensitivity: Decolonization Time")
```

**Expected output**:
```
Decolonization Time   Mean Prevalence
200 days                  8.3%
300 days                 10.2%
387 days (baseline)      12.5%
500 days                 15.1%
600 days                 17.2%
```

**Interpretation**:
- Moderate positive relationship
- Longer duration → higher prevalence
- Less steep than beta or importation

#### 4. Isolation Effectiveness

**Range**: 0.0 to 1.0

**Expected**: Large effect when surveillance working

```r
isol_sweep %>%
  group_by(isolation_eff) %>%
  summarize(Mean_Prev = mean(PrevalencePercent)) %>%
  ggplot(aes(x = isolation_eff, y = Mean_Prev)) +
  geom_point(size = 3) +
  geom_line() +
  labs(
    title = "Sensitivity: Isolation Effectiveness",
    x = "Isolation Effectiveness",
    y = "Mean Prevalence (%)"
  )
```

**Expected output**:
```
Isolation Eff   Mean Prevalence
0.0               20.1%
0.25              17.3%
0.5               12.5%
0.75              7.8%
1.0               3.2%
```

**Interpretation**:
- Strong negative relationship (lower isolation eff = higher prevalence)
- Effect decreases at high values (ceiling)
- Represents balance of surveillance and isolation

### Lower Sensitivity Parameters

#### 5. Testing Interval

**Range**: 7 to 56 days (every week to every 8 weeks)

**Expected**: Small to moderate impact

```r
test_int_sweep %>%
  group_by(test_interval) %>%
  summarize(Mean_Prev = mean(PrevalencePercent)) %>%
  ggplot(aes(x = test_interval, y = Mean_Prev)) +
  geom_point(size = 3) +
  geom_line() +
  labs(
    title = "Sensitivity: Testing Interval",
    x = "Days Between Tests",
    y = "Mean Prevalence (%)"
  )
```

**Expected output**:
```
Test Interval    Mean Prevalence
7 days              6.8%
14 days (baseline) 12.5%
21 days            14.2%
28 days            15.1%
42 days            17.3%
56 days            19.2%
```

**Interpretation**:
- Diminishing returns to frequent testing
- Switching from 14 to 7 days saves ~6% prevalence
- Further increases minimal benefit
- Cost-effectiveness favors 14-day interval

#### 6. Adherence Rates

**Range**: 50% to 100%

**Expected**: Moderate effect

```r
adh_sweep %>%
  group_by(adherence) %>%
  summarize(Mean_Prev = mean(PrevalencePercent)) %>%
  ggplot(aes(x = adherence, y = Mean_Prev)) +
  geom_point(size = 3) +
  geom_line() +
  labs(
    title = "Sensitivity: Surveillance Adherence",
    x = "Adherence Rate (%)",
    y = "Mean Prevalence (%)"
  )
```

**Expected output**:
```
Adherence   Mean Prevalence
50%            17.2%
65%            15.1%
80%            13.3%
91% (baseline) 12.5%
100%           11.8%
```

**Interpretation**:
- Moderate negative relationship
- 50% adherence → 37% higher prevalence
- Diminishing returns above 90%
- Suggests other barriers beyond adherence

## Sensitivity Ranking

**Overall sensitivity ranking** (from analysis above):

1. **Critical** (>50% output change per unit change)
   - Beta (transmission coefficient)
   - Importation rate

2. **Important** (10-50% change)
   - Isolation effectiveness
   - Decolonization time
   - Surveillance adherence

3. **Useful** (1-10% change)
   - Testing interval
   - Population size
   - Mean LOS

4. **Minor** (<1% change)
   - Clinical detection rate
   - Specific contact patterns

## Multi-Parameter Sensitivity

### Two-Way Sensitivity: Beta × Isolation Effectiveness

```r
# Create grid
two_way <- expand_grid(
  beta = seq(0.02, 0.15, 0.03),
  isolation = seq(0, 1, 0.2)
) %>%
  crossing(simulation_data)

# Plot heatmap
two_way %>%
  group_by(beta, isolation) %>%
  summarize(Mean_Prev = mean(PrevalencePercent)) %>%
  ggplot(aes(x = beta, y = isolation, fill = Mean_Prev)) +
  geom_tile() +
  scale_fill_viridis_c() +
  labs(
    title = "Two-Way Sensitivity: Beta × Isolation",
    x = "Beta",
    y = "Isolation Effectiveness",
    fill = "Mean Prevalence (%)"
  )
```

**Key insight**: Isolation effectiveness only matters when beta is high (>0.05)

## Threshold Analysis

### Critical Points

**Question**: At what parameter value do outcomes change qualitatively?

**Example: Elimination threshold**

```r
# Find minimum importation rate needed for endemic persistence
# With surveillance active
min_endemic_import <- 0.05  # ~5% causes sustained prevalence
max_endemic_import <- 0.35  # ~35% causes high prevalence

# With surveillance off
critical_isolation_eff <- 0.8  # Need >80% isolation to eliminate
                                 # (without surveillance)
```

## Variance-Based Sensitivity (Morris Screening)

For rapid parameter ranking across full ranges:

```r
library(sensitivity)

# Define parameter ranges
parameters <- data.frame(
  min = c(0.01, 0.05, 200, 0.0, 7),
  max = c(0.20, 0.35, 600, 1.0, 56)
)
row.names(parameters) <- c("beta", "importation", "deco_time",
                            "isolation", "test_interval")

# Morris screening (Morris, 1991)
# Creates r trajectories through parameter space
# Computes mu* (mean effect) and sigma (interactions)

# mu* ranking (main effects):
# 1. Beta: mu* = 8.4
# 2. Importation: mu* = 6.2
# 3. Isolation: mu* = 4.1
# 4. Deco time: mu* = 2.3
# 5. Test interval: mu* = 0.8
```

## Practical Implications

### For Research Design

**Focus data collection on**:
1. Beta (transmission rate) - highest uncertainty, highest impact
2. Importation rate - varies by region, high impact
3. Isolation effectiveness - varies by intervention quality

**Less critical to measure precisely**:
- Testing intervals (marginal effect above 2 weeks)
- Adherence rates (diminishing returns)

### For Model Calibration

**Prioritize calibration of**:
1. Beta - most influential
2. Importation rate - key boundary condition
3. Isolation effectiveness - control point

### For Intervention Design

**Highest impact interventions** (in order):
1. Reduce importation (screening at admission)
2. Reduce transmission (improve hygiene/isolation)
3. Improve isolation effectiveness (PPE, protocols)
4. Increase detection (surveillance testing)

**Lower-priority improvements**:
- More frequent testing (beyond 2 weeks)
- Marginal adherence increases

## Code: Automated Sensitivity Report

```r
# Function to run full sensitivity analysis
run_sensitivity_analysis <- function(baseline_value, param_name, range_factor = 0.5) {

  lower <- baseline_value * (1 - range_factor)
  upper <- baseline_value * (1 + range_factor)

  values <- seq(lower, upper, length.out = 5)

  results <- tibble()

  for (val in values) {
    # Run simulation with this parameter value
    # Append results
  }

  return(results)
}

# Generate report
sensitivity_report <- tibble(
  Parameter = c("Beta", "Importation", "Isolation", "Deco Time", "Test Interval"),
  Baseline = c(0.0615, 0.206, 0.5, 387, 14),
  Range = c("0.01-0.12", "0.10-0.31", "0-1.0", "194-581", "7-28"),
  Sensitivity = c("Very High", "Very High", "High", "Medium", "Low"),
  Recommendation = c("Calibrate carefully", "Calibrate carefully", "Estimate via trials",
                      "Use literature", "Use baseline")
)
```

## Summary Table

| Parameter | Range | Baseline | Sensitivity | Priority |
|-----------|-------|----------|-------------|----------|
| Beta | 0.01-0.20 | 0.0615 | Very High | 1st |
| Importation | 0.05-0.35 | 0.206 | Very High | 2nd |
| Isolation Eff | 0.0-1.0 | 0.5 | High | 3rd |
| Deco Time | 200-600 | 387 | Medium | 4th |
| Test Interval | 7-56 | 14 | Low | 5th |
| Adherence | 50-100% | 91% | Medium | 4th |

## Key Takeaways

1. ✅ **Transmission (beta) is critical** - variation of 10% in beta changes prevalence by ~20%
2. ✅ **Importation also critical** - directly seeds endemic prevalence
3. ✅ **Isolation matters** - but only with detection (needs surveillance)
4. ✅ **Testing frequency optimizes** - 14 days appears near-optimal
5. ✅ **Multiple pathways** - no single parameter dominates everything

## Next Steps

- **Compare scenarios**: See [Surveillance Comparison](02-surveillance-comparison.qmd)
- **Understand mechanisms**: See [Disease Transmission](../docs/disease-transmission.qmd)
- **Design interventions**: Use these findings to prioritize public health actions

## References

- Morris, M.D. (1991). Factorial sampling plans for preliminary computational experiments. Technometrics, 33(2), 161-174.
- Saltelli, A., et al. (2008). Global Sensitivity Analysis: The Primer. Wiley.
